<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>EU Space Network Map</title>
    <!-- leaflet css -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
      body{
        margin:0;
        padding:0;
      }
      #map{
        position: relative;
        width: 100%;
        max-width: 100%;
        height: 95vh;
        margin: auto;
        margin-top: 20px;
      }

      .filter-container{
        position:absolute;
        bottom:25px; left:10px;
        background:#fff;
        padding:12px 14px;
        box-shadow:0 0 15px rgba(0,0,0,.2);
        border-radius:8px;
        z-index:1000;
      }

      .filters{
        display:grid;
        grid-template-columns: repeat(3, minmax(180px, 1fr));
        gap:10px 16px;
      }

      .chk{
        display:flex;
        align-items:center;
        gap:8px;
        font-family:sans-serif;
        font-size:13px;
        color:#333;
      }
      .chk input{ margin:0; }

      .legend-card{
        background:#fff;
        padding:12px 14px;
        box-shadow:0 0 15px rgba(0,0,0,.2);
        border-radius:8px;
        font-family:sans-serif;
        font-size:13px;
        color:#333;
        line-height:1.4;
      }
      .legend-card img{
        vertical-align:middle;
        margin-right:8px;
      }

      .legend-row{
        display:flex;
        align-items:center;
        gap:8px;
        margin:2px 0;
      }

      .legend-icon{
        width:18px;
        height:18px;
        display:inline-block;
        flex:0 0 18px;
        background-size:contain;
        background-repeat:no-repeat;
        background-position:center;
      }

      @media (max-width: 700px){
        .filters{ grid-template-columns:1fr; }
      }
    </style>
  </head>

  <body>
      <div id="map">
        <div class="filter-container">
          <div class="filters">
            <label class="chk">
              <input type="checkbox" id="CopAmbsCheckbox" checked>
              Copernicus Ambassadors
            </label>

            <label class="chk">
              <input type="checkbox" id="GalAmbsCheckbox" checked>
              Galileo/EGNOS Ambassadors
            </label>

            <label class="chk">
              <input type="checkbox" id="STMAmbsCheckbox" checked>
              SSA/STM Ambassadors
            </label>

            <label class="chk">
              <input type="checkbox" id="EUSAmbsCheckbox" checked>
              EU Space Ambassadors
            </label>
          </div>
        </div>       
      </div>

<!-- leaflet js -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- import relays variable from external javascript file -->
<script src="CopernicusAmbassadors.js"></script>
<script src="GalileoAmbassadors.js"></script>
<script src="STMAmbassadors.js"></script>
<script src="EUSpaceAmbassadors.js"></script>

<script> 
// Map init
const map = L.map('map').setView([49.5, 15],4);

// GISCO layer
const giscoLayer = L.tileLayer('https://gisco-services.ec.europa.eu/maps/tiles/OSMCartoComposite/EPSG3857/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; EC-GISCO | Â© OSM'
});
giscoLayer.addTo(map);

// ICONS
const myIcon_Orange = L.icon({ iconUrl: 'Orange.svg', iconSize: [25,25] });
const myIcon_Blue = L.icon({ iconUrl: 'Blue.svg', iconSize: [25,25] });
const myIcon_LightBlue = L.icon({ iconUrl: 'LightBlue.svg', iconSize: [25,25] });
const myIcon_Purple = L.icon({ iconUrl: 'Purple.svg', iconSize: [25,25] });
const myIcon_Red = L.icon({ iconUrl: 'Red.svg', iconSize: [25,25] });

// Dedicated layer groups
const CopLayer = L.layerGroup().addTo(map);
const GalLayer = L.layerGroup().addTo(map);
const STMLayer = L.layerGroup().addTo(map);
const EUSLayer = L.layerGroup().addTo(map);

// Marker size updater
function updateMarkerSize() {
  const currentZoom = map.getZoom();
  let newSize = [30 * (currentZoom / 5), 30 * (currentZoom / 5)];
  const maxSize = [30, 30];
  newSize = [ Math.min(newSize[0], maxSize[0]), Math.min(newSize[1], maxSize[1]) ];

  myIcon_Purple.options.iconSize = newSize;
  myIcon_Orange.options.iconSize = newSize;
  myIcon_Red.options.iconSize = newSize;
  myIcon_Blue.options.iconSize = newSize;

  map.eachLayer(layer => {
    if (layer instanceof L.Marker) {
      layer.setIcon(L.icon({
        iconUrl: layer.options.icon.options.iconUrl,
        iconSize: newSize
      }));
    }
  });
}

// COP AMBASSADORS
for (let i = 0; i < CopAmbs.length; i++) {
  const copAmb = CopAmbs[i];
  const coordinates = copAmb.Coordinates.split(',').map(coord => parseFloat(coord.trim()));

  if (!isNaN(coordinates[0])) {
    let popupContent = `
      <strong>${copAmb.Name}</strong><br>
      Primary contact: ${copAmb.Contact}<br>
      Email: <a href="mailto:${copAmb.Email}">${copAmb.Email}</a><br>`;
    if (copAmb.Link) popupContent += `<a href="${copAmb.Link}" target="_blank">More info</a>`;

    L.marker(coordinates, { icon: myIcon_Orange })
      .bindPopup(popupContent)
      .addTo(CopLayer);  
  }
}

// GALILEO AMBASSADORS
for (let i = 0; i < GalAmbs.length; i++) {
  const galAmb = GalAmbs[i];
  const coordinates = galAmb.Coordinates.split(',').map(coord => parseFloat(coord.trim()));

  if (!isNaN(coordinates[0])) {
    let popupContent = `
      <strong>${galAmb.Name}</strong><br>
      Primary contact: ${galAmb.Contact}<br>
      Email: <a href="mailto:${galAmb.Email}">${galAmb.Email}</a><br>`;
    if (galAmb.Link) popupContent += `<a href="${galAmb.Link}" target="_blank">More info</a>`;

    L.marker(coordinates, { icon: myIcon_Blue })
      .bindPopup(popupContent)
      .addTo(GalLayer);  
  }
}

// STM AMBASSADORS
for (let i = 0; i < STMAmbs.length; i++) {
  const stmAmb = STMAmbs[i];
  const coordinates = stmAmb.Coordinates.split(',').map(coord => parseFloat(coord.trim()));

  if (!isNaN(coordinates[0])) {
    let popupContent = `
      <strong>${stmAmb.Name}</strong><br>
      Primary contact: ${stmAmb.Contact}<br>
      Email: <a href="mailto:${stmAmb.Email}">${stmAmb.Email}</a><br>`;
    if (stmAmb.Link) popupContent += `<a href="${stmAmb.Link}" target="_blank">More info</a>`;

    L.marker(coordinates, { icon: myIcon_Purple })
      .bindPopup(popupContent)
      .addTo(STMLayer); 
  }
}

// EU SPACE AMBASSADORS
for (let i = 0; i < EUSAmbs.length; i++) {
  const EUSAmb = EUSAmbs[i];
  const coordinates = EUSAmb.Coordinates.split(',').map(coord => parseFloat(coord.trim()));

  if (!isNaN(coordinates[0])) {
    let popupContent = `
      <strong>${EUSAmb.Name}</strong><br>
      Primary contact: ${EUSAmb.Contact}<br>
      Email: <a href="mailto:${EUSAmb.Email}">${EUSAmb.Email}</a><br>`;
    if (EUSAmb.Link) popupContent += `<a href="${EUSAmb.Link}" target="_blank">More info</a>`;

    L.marker(coordinates, { icon: myIcon_LightBlue })
      .bindPopup(popupContent)
      .addTo(EUSLayer);   
  }
}

// Legend
const legend = L.control({ position: 'topright' });
legend.onAdd = function () {
  const div = L.DomUtil.create('div', 'legend-card');
  div.innerHTML = `
    <div class="legend-row"><span class="legend-icon" style="background-image:url('Red.svg');"></span> EU Space Support Office</div>
    <div class="legend-row"><span class="legend-icon" style="background-image:url('Orange.svg');"></span> Copernicus Ambassadors</div>
    <div class="legend-row"><span class="legend-icon" style="background-image:url('Blue.svg');"></span> Galileo/EGNOS Ambassadors</div>
    <div class="legend-row"><span class="legend-icon" style="background-image:url('Purple.svg');"></span> SSA/STM Ambassadors</div>
    <div class="legend-row"><span class="legend-icon" style="background-image:url('Blue.svg');"></span> EU Space Ambassadors</div>
  `;
  return div;
};
legend.addTo(map);

// EU SUPPORT OFFICE MARKER
const EUSSOLayer = L.layerGroup().addTo(map);
const brusselsCoordinates = [50.8403436233206, 4.384885539104331];
const brusselsPopup = `
  <strong>EU Space Support Office</strong><br>
  Email: <a href="mailto:support@euspace-programme.eu">support@euspace-programme.eu</a><br>
  <a href="https://www.copernicus.eu/en" target="_blank">More info</a>
`;
L.marker(brusselsCoordinates, {icon: myIcon_Red})
  .bindPopup(brusselsPopup)
  .addTo(EUSSOLayer);

// FILTER CHECKBOXES
function updateMarkers() {
  CopAmbsCheckbox.checked ? map.addLayer(CopLayer) : map.removeLayer(CopLayer);
  GalAmbsCheckbox.checked ? map.addLayer(GalLayer) : map.removeLayer(GalLayer);
  STMAmbsCheckbox.checked ? map.addLayer(STMLayer) : map.removeLayer(STMLayer);
  EUSAmbsCheckbox.checked ? map.addLayer(EUSLayer) : map.removeLayer(EUSLayer);
}

CopAmbsCheckbox.addEventListener('change', updateMarkers);
GalAmbsCheckbox.addEventListener('change', updateMarkers);
STMAmbsCheckbox.addEventListener('change', updateMarkers);
EUSAmbsCheckbox.addEventListener('change', updateMarkers);

map.on('zoomend', updateMarkerSize);
</script>
</body>
</html>
